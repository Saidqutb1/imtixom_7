{% extends "base.html" %}
{% load custom_filters %}

{% block title %}Chat{% endblock %}

{% block content %}
<h2>Chat with {{ other_participant.username }}</h2>
{% if other_participant.profile.online %}
    <p>Status: Online</p>
{% else %}
    <p>Status: Offline (Last seen: {{ other_participant.profile.last_seen|date:"d M Y H:i:s" }})</p>
{% endif %}
<div>
    {% for message in messages %}
        <p><strong>{{ message.sender.username }}:</strong> {{ message.text }}</p>
        {% if message.file %}
            {% if message.file.url|is_image %}
                <p><img src="{{ message.file.url }}" style="max-width: 300px; max-height: 300px;"></p>
            {% elif message.file.url|is_video %}
                <p><video width="320" height="240" controls>
                    <source src="{{ message.file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video></p>
            {% elif message.file.url|is_audio %}
                <p><audio controls>
                    <source src="{{ message.file.url }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio></p>
            {% endif %}
        {% endif %}
    {% endfor %}
</div>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.text }}
    {{ form.file }}
    <button type="submit">Send</button>
</form>
{% endblock %}









